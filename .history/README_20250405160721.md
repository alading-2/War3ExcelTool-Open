# Excel 到 TypeScript 转换工具

## 项目简介

Excel 到 TypeScript 转换工具是一个 Python 应用程序，可以将 Excel 表格数据自动转换为 TypeScript 代码。这个工具专为需要从 Excel 数据生成 TypeScript 代码的开发人员设计。

## 主要功能

- **Excel 解析**：自动解析 Excel 文件，根据指定规则提取数据
- **类型推断**：自动判断数据类型，支持 number、string、boolean 和复杂类型
- **颜色处理**：支持提取并转换 Excel 中的文本颜色信息
- **代码生成**：生成符合规范的 TypeScript 接口和类
- **批量处理**：支持批量处理多个 Excel 文件
- **图形界面**：提供友好的用户界面，便于操作
- **多工作表支持**：支持处理包含多个工作表的 Excel 文件
- **智能打包**：打包时自动关闭正在运行的程序，打包完成后自动打开新的可执行文件
- **预处理指令**：支持在 Excel 文件的前几行添加预处理指令，用于数据转换

## 安装方法

### 使用可执行文件（推荐）

1. 下载最新的安装包
2. 运行安装程序，按照提示进行安装
3. 安装完成后，从开始菜单或桌面快捷方式启动程序

### 从源码安装

1. 克隆仓库：

   ```
   git clone https://github.com/yourusername/excel-to-ts.git
   cd excel-to-ts
   ```

2. 安装依赖：

   ```
   pip install -r requirements.txt
   ```

3. 运行程序：

   ```
   python -m src.main
   ```

### 打包为可执行文件

如果要将程序打包为可执行文件，可以运行：

```
python build.py
```

打包过程有以下特点：

- 自动检查并关闭正在运行的 ExcelToTS.exe 程序
- 打包完成后自动打开新生成的可执行文件

## 使用方法

### 图形界面

1. 启动程序
2. 选择包含 Excel 文件的输入目录
3. 选择 TypeScript 文件的输出目录
4. 勾选"递归处理子目录"选项（如果需要）
5. 点击"开始转换"按钮
6. 转换过程将在操作日志中显示

### 命令行

程序也支持命令行操作：

```
excel_to_ts -i /path/to/input -o /path/to/output -r
```

参数说明：

- `-i, --input`：输入目录
- `-o, --output`：输出目录
- `-r, --recursive`：递归处理子目录
- `--log-level`：日志级别，可选值为 DEBUG, INFO, WARNING, ERROR, CRITICAL
- `--batch-size`：批处理大小

## Excel 文件格式要求

为了正确转换，Excel 文件需要符合以下格式：

1. 第一行作为注释
2. 第二行作为数据的 key 值
3. 第三行及以下为实际数据
4. 第一列作为数据 ID 用于索引
5. 忽略首列为"//"的行
6. 空数据单元格不会被提取

### 预处理指令

工具支持在 Excel 文件的前几行添加预处理指令，这些指令会影响数据的处理方式：

1. **指令格式**：预处理指令以 `#` 开头，可以放置在单元格的任意位置，一个单元格可以包含多个指令
2. **支持的指令**：

   - `#default <value>`: 为该列的空值单元格设置默认值
   - `#path`: 将该列字符串值中的 `\` 替换为 `\\`（用于路径格式）

3. **指令位置**：指令应放在实际数据表头之前的行中
4. **示例**：

   | 攻击力说明 #default 0 | 图标路径信息 #path                              |
   | --------------------- | ----------------------------------------------- |
   | 攻击力                | 图标路径                                        |
   | 10                    | ReplaceableTextures\CommandButtons\BTNSword.blp |
   | 20                    | ReplaceableTextures\CommandButtons\BTNAxe.blp   |

   在这个例子中：

   - 第一列"攻击力"的空值会被替换为 0（因为有 `#default 0` 指令）
   - 第二列"图标路径"的值会将反斜杠替换为双反斜杠（因为有 `#path` 指令）

5. **多个指令**：一个单元格可以包含多个预处理指令，它们会按顺序应用：

   | 路径设置 #default 无图标 #path                  |
   | ----------------------------------------------- |
   | 图标路径                                        |
   | ReplaceableTextures\CommandButtons\BTNSword.blp |
   |                                                 |

   在这个例子中，第一列既有默认值"无图标"，也会进行路径转换。空值会被替换为"无图标"，然后如果值是字符串，会进行路径转换。

## 生成的 TypeScript 代码

假设 Excel 文件名为"演员单位.xlsx"，生成的 TypeScript 文件将命名为"xlsx\_演员单位.ts"，包含：

1. 接口索引常量：`xlsx_inte_keys_演员单位`
2. 接口定义：`xlsx_inte_演员单位`
3. 数据常量：`xlsx_data_演员单位`
4. 类定义：`xlsx_演员单位`，包含 Start 方法

## 颜色代码支持

工具支持从 Excel 提取文本颜色，并转换为特定格式。例如，红色文本将转换为：

```typescript
"|cffff0000文本内容|r";
```

支持的颜色代码：

- 红色：`|cffff0000`
- 黄色：`|cffffff00`
- 绿色：`|cff00ff00`
- 蓝色：`|cff0000ff`
- 紫色：`|cffff00ff`
- 黑色：`|c00000000`
- 白色：`|cffffffff`

## 常见问题

1. **Q: 为什么我的 Excel 文件没有被正确转换？**A: 请确保 Excel 文件格式符合要求，特别是第一行为注释，第二行为键名。
2. **Q: 能否自定义输出文件的命名格式？**A: 当前版本不支持自定义命名格式，未来版本可能添加此功能。
3. **Q: 支持哪些 Excel 文件格式？**
   A: 支持.xlsx 格式，不支持旧的.xls 格式。
4. **Q: 预处理指令需要放在哪里？**
   A: 预处理指令应放在 Excel 文件的前几行，最多支持检查前 3 行。指令行后的第一行将被视为表头。指令可以放在单元格的任意位置，一个单元格可以包含多个指令。

## 贡献指南

欢迎贡献代码或提出建议！请遵循以下步骤：

1. Fork 仓库
2. 创建功能分支：`git checkout -b feature/your-feature`
3. 提交更改：`git commit -m 'Add your feature'`
4. 推送到分支：`git push origin feature/your-feature`
5. 提交 Pull Request

## 许可证

本项目采用 MIT 许可证。详情请参阅[LICENSE](LICENSE)文件。

## ExcelTable Class

The `ExcelTable` class is a data structure designed to encapsulate Excel table data along with its metadata. It provides a clean interface for accessing and manipulating Excel data that has been read into a pandas DataFrame.

### Key Features:

- Automatically cleans and processes raw Excel data
- Extracts column metadata (comments, keys)
- Filters out comment rows and empty rows
- Provides convenient methods for accessing data by cell, row, or column
- Integrates with ColumnInfo for metadata management

### Usage Example:

```python
import pandas as pd
from src.core.data_handler import ExcelTable

# Read raw data from Excel
raw_df = pd.read_excel("example.xlsx", sheet_name="Sheet1", header=None)

# Create ExcelTable instance
excel_table = ExcelTable(raw_df)

# Access data using convenient methods
cell_value = excel_table.get_cell(row_idx=0, col_idx=1)
row_data = excel_table.get_row(row_idx=0)
column_data = excel_table.get_col_by_key(key="id")

# Get column metadata
column_info = excel_table.get_column_info(key="id")
print(f"Column comment: {column_info.comment}")

# Iterate through all rows
for idx, row in excel_table.iterrows():
    print(f"Row {idx}: {row}")
```

## Excel to TypeScript Converter

This project also includes functionality to convert Excel data to TypeScript interfaces and constants.

### Features:

- Convert Excel sheets to TypeScript interfaces
- Generate TypeScript constant data from Excel rows
- Support for comments and type inference
- Command-line interface for easy use

### Command-line Usage:

```bash
# Convert an Excel file to TypeScript
python src/cli.py example.xlsx -o ./ts_output

# Get help information
python src/cli.py --help
```

### Programmatic Usage:

```python
from src.core.excel_to_ts import ExcelToTypeScript

# Create converter instance
converter = ExcelToTypeScript()

# Convert Excel file to TypeScript
generated_files = converter.convert_excel_to_ts("example.xlsx", "ts_output")

# Print generated files
for file_path in generated_files:
    print(f"Generated: {file_path}")
```

### Generated Files

For each sheet in the Excel file, the converter generates:

1. `{sheetName}.interface.ts` - TypeScript interface definition
2. `{sheetName}.data.ts` - TypeScript constants with the data

Example interface file:

```typescript
// Auto-generated TypeScript interface
export interface UserData {
  /** User identifier */
  id: number;
  /** Full name */
  name: string;
  /** Is account active */
  active: boolean;
}
```

Example data file:

```typescript
// Auto-generated TypeScript constants
import { UserData } from "./userData.interface";

export const userDataData: UserData[] = [
  {
    id: 1,
    name: "John Doe",
    active: true,
  },
  {
    id: 2,
    name: "Jane Smith",
    active: false,
  },
];
```
